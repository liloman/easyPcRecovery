# clear the display to keep it clean!
clear
# allow text output from any future commands  so 
# we can debug the menu items and use find to set vars
debug on

# Finds equipment the device is set to first find the current device. 
# Default search order: ud, pxe, network equipment, hard disk, CD-ROM, floppy disk
# --devices=upnhcf

#find windows drive
find --devices=h /windows/explorer.exe  | set OTITLE= 

# find by disks first and then cd-rom for DTITLE ... (patched by me!)
# https://github.com/chenall/grub4dos/issues/93
find --devices=hc /easyPcRecovery/clonezilla/live/vmlinuz | set DTITLE= 

# find source volume for Windows and our backup volume  and set root for real :S
find --set-root --devices=hc /easyPcRecovery/menus/getDisks.g4b 
# TODO: autodetect and use hda instead of sda if IDE HDD 
command /easyPcRecovery/menus/getDisks.g4b

#dont Use %LOCALES% by default...
#set LOCALES=locales="es_ES.UTF-8" keyboard-layouts="es"
set BOPT=boot=live quiet live-config noswap edd=on nomodeset ip=frommedia union=overlay nosplash 
#For clonezillas
set RUN=ocs_live_run="ocs-live-general" live-media-path=/easyPcRecovery/clonezilla/live bootfrom=/dev/%BAKDRV% toram=filesystem.squashfs
#For recovery/backup only
set PRERUN=ocs_prerun="mount /dev/%BAKDRV% /mnt" ocs_prerun1="mount --bind /mnt/easyPcRecovery/clonezilla/images /home/partimag/"

timeout 25
default 0

iftitle [find --devices=h /ntldr] ^F3 F3 Boot Windows XP from %OTITLE% 
find --set-root --devices=h /ntldr 
chainloader /ntldr

# If false
iftitle [ checkrange 0 find --devices=h /easyPcRecovery/easyPcRecovery.txt ] You need a partition/disk prepared for backups
echo You need a partition/disk prepared for backups with the /easyPcRecovery/easyPcRecovery.txt file

iftitle [ find --devices=h /easyPcRecovery/easyPcRecovery.txt  ] ^F5 F5 Recover Windows XP Backup from %DTITLE% to %OTITLE%
#dont fit locales
set RUN1=ocs_live_run="ocs-sr -c --batch -e1 auto -e2 -j2 -k -p reboot restoreparts ask_user %WDRV%"
kernel /easyPcRecovery/clonezilla/live/vmlinuz %BOPT% %RUN% %PRERUN% %RUN1% %LOCALES% ocs_live_batch="yes"
initrd /easyPcRecovery/clonezilla/live/initrd.img

iftitle [ find --devices=h /easyPcRecovery/easyPcRecovery.txt  ] ^F6 F6 Backup Windows XP from %OTITLE% to %DTITLE%
#dont fit locales
set RUN1=ocs_live_run="ocs-sr -q2 -sc -rm-win-swap-hib -c --batch -j2 -z1 -i 2000 -p reboot saveparts ask_user %WDRV%"
kernel /easyPcRecovery/clonezilla/live/vmlinuz %BOPT% %RUN% %PRERUN% %RUN1% %LOCALES% ocs_live_batch="yes"
initrd /easyPcRecovery/clonezilla/live/initrd.img

iftitle [ find --devices=hc /easyPcRecovery/clonezilla/live/vmlinuz  ] ^F7 F7 Boot clonezilla (manual) from %DTITLE%
kernel /easyPcRecovery/clonezilla/live/vmlinuz %LOCALES% %BOPT% %RUN% ocs_live_batch="no"
initrd /easyPcRecovery/clonezilla/live/initrd.img

iftitle [ find --devices=hc /easyPcRecovery/gparted/vmlinuz ] ^F8 F8 GParted live (partitioning) from %DTITLE%
set LOCALES=locales="es_ES.UTF-8" keyboard-layouts="es"
set RUN=live-media-path=/easyPcRecovery/gparted bootfrom=/dev/%BAKDRV% toram=filesystem.squashfs 
kernel /easyPcRecovery/gparted/vmlinuz %BOPT% %RUN% %LOCALES% gl_batch union=aufs
initrd /easyPcRecovery/gparted/initrd.img

iftitle [ find --devices=hc /easyPcRecovery/menus/extras.lst ] ^F9 F9 Extra Options (recovery console,Windows Vista/7,USB boot,Slitaz)
configfile /easyPcRecovery/menus/extras.lst
