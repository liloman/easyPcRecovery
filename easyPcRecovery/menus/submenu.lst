# clear the display to keep it clean!
clear
# allow text output from any future commands  so 
# we can debug the menu items and use find to set vars
debug on

# Finds equipment the device is set to first find the current device. 
# Default search order: ud, pxe, network equipment, hard disk, CD-ROM, floppy disk
# --devices=upnhcf

#find windows drive with errors 
find --set-root --devices=h /windows/explorer.exe  
#find windows drive without errors... Â¿?
find --devices=h /windows/explorer.exe  | set OTITLE=

# to order find by disks first for DTITLE ...
# https://github.com/chenall/grub4dos/issues/93
root (hd0,0)
find --set-root --devices=hc /easyPcRecovery/clonezilla/live/vmlinuz 
#find backup drive first in hd and then in cd-roms  (and set-root for real? :S)
find --set-root --devices=hc /easyPcRecovery/clonezilla/live/vmlinuz | set DTITLE=

# find source volume for Windows and our backup volume 
find --set-root --devices=hc /easyPcRecovery/menus/getDisks.g4b
# should autodetect and use hda instead of sda if IDE HDD 
command /easyPcRecovery/menus/getDisks.g4b

#dont Use %LOCALES% by default...
#set LOCALES=locales="es_ES.UTF-8" keyboard-layouts="es"
set BOPT=boot=live quiet live-config noswap edd=on nomodeset ip=frommedia union=overlay nosplash 
#For clonezillas
set RUN=ocs_live_run="ocs-live-general" live-media-path=/easyPcRecovery/clonezilla/live bootfrom=/dev/%BAKDRV% toram=filesystem.squashfs
#For recovery/backup only
set PRERUN=ocs_prerun="mount /dev/%BAKDRV% /mnt" ocs_prerun1="mount --bind /mnt/easyPcRecovery/clonezilla/images /home/partimag/"

timeout 25
default 0

iftitle [ if not exist %SHOW%/easyPcRecovery/clonezilla/live/vmlinuz ] You need a partition/disk with a clonezilla installation
echo You need a partition/disk with a clonezilla installation

iftitle [find --devices=h /ntldr] ^F3 F3 Boot Windows XP from %OTITLE%
find --set-root --devices=h /ntldr
chainloader /ntldr

iftitle [ if exist %DTITLE%/easyPcRecovery/clonezilla/images/images_are_stored_here.txt  ] ^F5 F5 Recover Windows XP Backup from %DTITLE% to %OTITLE%
#dont fit locales
set RUN1=ocs_live_run="ocs-sr -c --batch -e1 auto -e2 -j2 -k -p reboot restoreparts ask_user %WDRV%"
kernel /easyPcRecovery/clonezilla/live/vmlinuz %BOPT% %RUN% %PRERUN% %RUN1% %LOCALES% ocs_live_batch="yes"
initrd /easyPcRecovery/clonezilla/live/initrd.img

iftitle [ if exist %DTITLE%/easyPcRecovery/clonezilla/images/images_are_stored_here.txt  ] ^F6 F6 Backup Windows XP from %OTITLE% to %DTITLE%
#dont fit locales
set RUN1=ocs_live_run="ocs-sr -q2 -sc -rm-win-swap-hib -c --batch -j2 -z1 -i 2000 -p reboot saveparts ask_user %WDRV%"
kernel /easyPcRecovery/clonezilla/live/vmlinuz %BOPT% %RUN% %PRERUN% %RUN1% %LOCALES% ocs_live_batch="yes"
initrd /easyPcRecovery/clonezilla/live/initrd.img

iftitle [ if exist %DTITLE%/easyPcRecovery/clonezilla/live/vmlinuz  ] ^F7 F7 Boot clonezilla (manual) from %DTITLE%
kernel /easyPcRecovery/clonezilla/live/vmlinuz %LOCALES% %BOPT% %RUN% ocs_live_batch="no"
initrd /easyPcRecovery/clonezilla/live/initrd.img

iftitle [ if exist %DTITLE%/easyPcRecovery/gparted/vmlinuz ] ^F8 F8 GParted live (partitioning) from %DTITLE%
set LOCALES=locales="es_ES.UTF-8" keyboard-layouts="es"
set RUN=live-media-path=/easyPcRecovery/gparted bootfrom=/dev/%BAKDRV% toram=filesystem.squashfs 
kernel /easyPcRecovery/gparted/vmlinuz %BOPT% %RUN% %LOCALES% gl_batch union=aufs
initrd /easyPcRecovery/gparted/initrd.img

title ^F9 F9 Extra Options (recovery console,Windows Vista/7,USB boot,Slitaz)
configfile /easyPcRecovery/menus/extras.lst
